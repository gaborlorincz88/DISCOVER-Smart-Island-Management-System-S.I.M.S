<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cache Test</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .test { margin: 20px 0; padding: 15px; background: #f5f5f5; border-radius: 8px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin-top: 10px; padding: 10px; background: white; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>Mobile Cache Test</h1>
    <p>This page tests different caching strategies for images on mobile browsers.</p>
    
    <div class="test">
        <h3>Test 1: Standard Image</h3>
        <img id="img1" src="https://77.71.145.126:3002/uploads/optimized/icon-1755629717779-964265234-optimized.webp" onload="log('Image 1 loaded', this.src)" />
        <button onclick="testCache('img1')">Test Cache for Image 1</button>
        <div id="result1" class="result"></div>
    </div>
    
    <div class="test">
        <h3>Test 2: Image with Aggressive Cache Headers</h3>
        <img id="img2" src="https://77.71.145.126:3002/uploads/optimized/icon-1755629124800-625477324-optimized.webp" crossOrigin="anonymous" onload="log('Image 2 loaded', this.src)" />
        <button onclick="testCache('img2')">Test Cache for Image 2</button>
        <div id="result2" class="result"></div>
    </div>
    
    <div class="test">
        <h3>Test 3: Preloaded Image</h3>
        <img id="img3" src="https://77.71.145.126:3002/uploads/optimized/icon-1759428190569-87731669-optimized.webp" onload="log('Image 3 loaded', this.src)" />
        <button onclick="testCache('img3')">Test Cache for Image 3</button>
        <div id="result3" class="result"></div>
    </div>
    
    <script>
        function log(message, data) {
            console.log(message, data);
        }
        
        function testCache(imgId) {
            const img = document.getElementById(imgId);
            const startTime = performance.now();
            
            // Create a new image to test cache
            const testImg = new Image();
            testImg.src = img.src;
            
            testImg.onload = () => {
                const loadTime = performance.now() - startTime;
                const wasCached = loadTime < 50;
                const result = wasCached ? 
                    `âš¡ CACHED (${loadTime.toFixed(0)}ms)` : 
                    `ðŸ“¥ NETWORK (${loadTime.toFixed(0)}ms)`;
                
                document.getElementById(`result${imgId.slice(3)}`).textContent = result;
            };
            
            testImg.onerror = () => {
                document.getElementById(`result${imgId.slice(3)}`).textContent = 'âŒ ERROR';
            };
        }
        
        // Preload Image 3
        const img3Preload = new Image();
        img3Preload.src = 'https://77.71.145.126:3002/uploads/optimized/icon-1759428190569-87731669-optimized.webp';
        img3Preload.onload = () => console.log('Image 3 preloaded');
    </script>
    
    <div style="margin-top: 30px; padding: 15px; background: #e7f3ff; border-radius: 8px;">
        <h3>Instructions</h3>
        <ol>
            <li>Open this page on mobile</li>
            <li>Wait for images to load</li>
            <li>Click each test button</li>
            <li>Refresh the page (F5 or pull-to-refresh)</li>
            <li>Click test buttons again</li>
            <li>Compare: If "CACHED" shows on reload, mobile is caching. If "NETWORK" shows, mobile cleared the cache.</li>
        </ol>
    </div>
</body>
</html>

