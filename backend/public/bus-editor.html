<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bus Route Editor - Discover Gozo</title>
    <link rel="stylesheet" href="lib/leaflet.css" />
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="admin-styles.css">
    <link rel="stylesheet" href="lib/inter-font.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="admin-check.js"></script>
    <style>
        /* Modern iPhone-style Design */
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .content {
            background-color: transparent !important;
        }
        
        .tab-container {
            background-color: transparent !important;
        }
        
        .sidebar {
            background-color: transparent !important;
        }
        
        .sidebar-section {
            background-color: rgba(255, 255, 255, 0.1) !important;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Dropdown/Select styling */
        form select, select {
            background: rgba(255, 255, 255, 0.15) !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
            color: white !important;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }
        
        form select:focus, select:focus {
            border-color: rgba(255, 255, 255, 0.4) !important;
            background: rgba(255, 255, 255, 0.2) !important;
            box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.1) !important;
        }
        
        form select option, select option {
            background: rgba(102, 126, 234, 0.9) !important;
            color: white !important;
        }
        
        /* Modal styling */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            animation: fadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            margin: 20px;
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            background: rgba(255, 255, 255, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 24px 30px;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            color: white;
            font-weight: 700;
            font-size: 20px;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .modal-header h3 i {
            font-size: 22px;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .modal-close {
            color: rgba(255, 255, 255, 0.8);
            font-size: 24px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .modal-close:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .modal-body {
            padding: 30px;
            max-height: 70vh;
            overflow-y: auto;
            background: transparent;
        }
        
        .modal-footer {
            background: rgba(255, 255, 255, 0.05);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px 30px;
            border-radius: 0 0 20px 20px;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        
        .form-group {
            margin-bottom: 24px;
        }
        
        .form-group label {
            color: white;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-group label i {
            color: rgba(255, 255, 255, 0.8);
            font-size: 16px;
            width: 16px;
            height: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .form-input {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 16px 20px;
            color: white;
            font-size: 16px;
            font-weight: 500;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
            box-sizing: border-box;
        }
        
        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
            font-weight: 400;
        }
        
        .form-input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }
        
        .form-help {
            color: rgba(255, 255, 255, 0.7);
            font-size: 13px;
            margin-top: 8px;
            font-weight: 400;
            line-height: 1.4;
        }
        
        /* Custom marker styling for bus route editor */
        .stop-marker div {
            color: white;
            background-color: #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .shape-marker div {
            color: #3b82f6;
            font-size: 16px !important;
        }
        .custom-marker {
            margin-left: -12px !important;
            margin-top: -12px !important;
        }
        
        /* Point containers styling */
        .point-container {
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 12px;
            padding: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }
        
        .point-container:hover {
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
            transform: translateY(-1px);
        }
        
        .point-container.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }
        
        .point-container.drag-over {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        
        .point-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .point-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .point-number {
            background-color: #3b82f6;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
        }
        
        .point-text {
            font-weight: 500;
            color: #374151;
        }
        
        .point-buttons {
            display: flex;
            gap: 8px;
        }
        
        .edit-stop-btn, .remove-stop-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .edit-stop-btn:hover {
            background-color: #dbeafe;
        }
        
        .remove-stop-btn:hover {
            background-color: #fee2e2;
        }
        
        .add-shape-container {
            text-align: center;
            margin: 8px 0;
        }
        
        .add-shape-btn {
            background-color: #10b981;
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.2s ease;
        }
        
        .add-shape-btn:hover {
            background-color: #059669;
            transform: scale(1.1);
        }
        
        /* Modern Body & Layout */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        .main-container {
            display: flex;
            min-height: calc(100vh - 120px);
            gap: 0;
        }

        /* Modern Header */
        .main-header {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            margin: 20px;
            padding: 20px 30px;
        }

        .main-header h1 {
            color: white;
            font-size: 28px;
            font-weight: 700;
            margin: 0 0 15px 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .main-header h1 i {
            font-size: 32px;
            color: rgba(255, 255, 255, 0.9);
        }

        .top-menu {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .top-menu .btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .top-menu .btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .top-menu .btn.active {
            background: rgba(255, 255, 255, 0.4);
            border-color: rgba(255, 255, 255, 0.5);
        }

        /* Button Styling */
        .btn {
            padding: 12px 24px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(74, 222, 128, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .btn-info {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(6, 182, 212, 0.4);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
        }

        /* Sidebar Styling */
        .sidebar {
            width: 350px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin: 20px;
            padding: 30px;
            overflow-y: auto;
            max-height: calc(100vh - 140px);
        }

        .sidebar-section {
            margin-bottom: 30px;
        }

        .sidebar-section h2 {
            color: white;
            font-size: 20px;
            font-weight: 700;
            margin: 0 0 20px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-section h2 i {
            font-size: 22px;
            color: rgba(255, 255, 255, 0.9);
        }

        /* Content Styling */
        .content {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin: 20px 20px 20px 0;
            padding: 0;
            overflow: hidden;
        }

        #map {
            width: 100%;
            height: 100%;
            border-radius: 20px;
        }

        /* Form Styling */
        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            color: white;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 14px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
        }

        .input-group input::placeholder,
        .input-group textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        /* Additional Styling for Bus Editor Elements */
        #stops-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #stops-list li {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 8px;
            color: white;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #stops-list li:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .instructions {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            line-height: 1.5;
        }

        .form-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .filter-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }

        .filter-buttons .btn {
            flex: 1;
            text-align: center;
        }

        .filter-buttons .btn.active {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.4);
        }

        /* Modal Styling */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-content h2 {
            color: white;
            font-size: 24px;
            font-weight: 700;
            margin: 0 0 20px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Light Theme Support */
        [data-theme="light"] body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        [data-theme="light"] .main-header h1 {
            color: white;
        }

        [data-theme="light"] .main-header h1 i {
            color: rgba(255, 255, 255, 0.9);
        }

        [data-theme="light"] .top-menu .btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
        }
        
        [data-theme="light"] .top-menu .btn:hover {
            background: rgba(255, 255, 255, 0.3);
            color: white;
        }
        
        [data-theme="light"] .top-menu .btn.active {
            background: rgba(255, 255, 255, 0.4);
            border-color: rgba(255, 255, 255, 0.5);
            color: white;
        }

        [data-theme="light"] .sidebar-section h2 {
            color: white;
        }

        [data-theme="light"] .sidebar-section h2 i {
            color: rgba(255, 255, 255, 0.9);
        }

        [data-theme="light"] .input-group label {
            color: white;
        }

        [data-theme="light"] .input-group input,
        [data-theme="light"] .input-group select,
        [data-theme="light"] .input-group textarea {
            color: white;
        }

        [data-theme="light"] .input-group input:focus,
        [data-theme="light"] .input-group select:focus,
        [data-theme="light"] .input-group textarea:focus {
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
        }

        [data-theme="light"] .input-group input::placeholder,
        [data-theme="light"] .input-group textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        [data-theme="light"] .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        [data-theme="light"] .btn-primary:hover {
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        [data-theme="light"] .btn-success {
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
            color: white;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        [data-theme="light"] .btn-success:hover {
            box-shadow: 0 8px 25px rgba(74, 222, 128, 0.4);
        }
        
        [data-theme="light"] .btn-secondary {
            color: white;
        }
        
        [data-theme="light"] .btn-secondary:hover {
            color: white;
        }
        
        [data-theme="light"] .btn-info {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        [data-theme="light"] .btn-info:hover {
            box-shadow: 0 8px 25px rgba(6, 182, 212, 0.4);
        }
        
        [data-theme="light"] .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        [data-theme="light"] .btn-warning:hover {
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
        }
        
        [data-theme="light"] .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        [data-theme="light"] .btn-danger:hover {
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
        }

        [data-theme="light"] #stops-list li {
            color: white;
        }

        [data-theme="light"] .instructions {
            color: rgba(255, 255, 255, 0.8);
        }

        [data-theme="light"] .modal-content h2 {
            color: white;
        }

        [data-theme="light"] .filter-buttons .btn.active {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.4);
            color: white;
        }

        /* Dark Theme Support */
        [data-theme="dark"] body {
            background: linear-gradient(135deg, #2d1b69 0%, #1a0d4a 100%);
        }

        [data-theme="dark"] .main-header {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        [data-theme="dark"] .sidebar {
            background: rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        [data-theme="dark"] .content {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        [data-theme="dark"] .input-group input,
        [data-theme="dark"] .input-group select,
        [data-theme="dark"] .input-group textarea {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
        }

        [data-theme="dark"] .input-group input:focus,
        [data-theme="dark"] .input-group select:focus,
        [data-theme="dark"] .input-group textarea:focus {
            border-color: rgba(255, 255, 255, 0.3);
            background: rgba(0, 0, 0, 0.4);
        }

        [data-theme="dark"] .input-group input::placeholder,
        [data-theme="dark"] .input-group textarea::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        [data-theme="dark"] .btn-primary {
            background: linear-gradient(135deg, #4c1d95 0%, #581c87 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        [data-theme="dark"] .btn-primary:hover {
            box-shadow: 0 8px 25px rgba(76, 29, 149, 0.4);
        }
        
        [data-theme="dark"] .btn-success {
            background: linear-gradient(135deg, #166534 0%, #15803d 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        [data-theme="dark"] .btn-success:hover {
            box-shadow: 0 8px 25px rgba(22, 101, 52, 0.4);
        }
        
        [data-theme="dark"] .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        [data-theme="dark"] .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        [data-theme="dark"] .btn-info {
            background: linear-gradient(135deg, #0c4a6e 0%, #075985 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        [data-theme="dark"] .btn-info:hover {
            box-shadow: 0 8px 25px rgba(12, 74, 110, 0.4);
        }
        
        [data-theme="dark"] .btn-warning {
            background: linear-gradient(135deg, #92400e 0%, #b45309 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        [data-theme="dark"] .btn-warning:hover {
            box-shadow: 0 8px 25px rgba(146, 64, 14, 0.4);
        }
        
        [data-theme="dark"] .btn-danger {
            background: linear-gradient(135deg, #991b1b 0%, #b91c1c 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        [data-theme="dark"] .btn-danger:hover {
            box-shadow: 0 8px 25px rgba(153, 27, 27, 0.4);
        }

        /* Dark Theme for Additional Elements */
        [data-theme="dark"] #stops-list li {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        [data-theme="dark"] #stops-list li:hover {
            background: rgba(0, 0, 0, 0.4);
        }

        [data-theme="dark"] .instructions {
            color: rgba(255, 255, 255, 0.7);
        }

        [data-theme="dark"] .modal-content {
            background: rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        [data-theme="dark"] .modal-content h2 {
            color: white;
        }

        [data-theme="dark"] .filter-buttons .btn.active {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        /* Theme Toggle Button */
        .theme-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }
        
        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .theme-toggle svg {
            width: 24px;
            height: 24px;
            color: white;
            transition: all 0.3s ease;
        }
        
        [data-theme="dark"] .theme-toggle {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        [data-theme="dark"] .theme-toggle:hover {
            background: rgba(0, 0, 0, 0.4);
        }
    </style>
</head>
<body>
    <header class="main-header">
        <h1><i class="fas fa-bus"></i> Discover Gozo Admin</h1>
        <nav class="top-menu">
            <a href="/admin.html" class="btn btn-secondary"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
            <a href="/analytics.html" class="btn btn-secondary"><i class="fas fa-chart-line"></i> Analytics</a>
            <a href="/weather-admin.html" class="btn btn-secondary"><i class="fas fa-cloud-sun"></i> Weather</a>
            <a href="/bus-editor.html" class="btn btn-primary active"><i class="fas fa-bus"></i> Bus Routes</a>
            <a href="/new-route-editor.html" class="btn btn-secondary"><i class="fas fa-map-marked-alt"></i> Tour Routes</a>
            <a href="/category-editor.html" class="btn btn-secondary"><i class="fas fa-tags"></i> Category Editor</a>
            <a href="/gallery-manager.html" class="btn btn-secondary"><i class="fas fa-images"></i> Gallery</a>
            <a href="/users.html" class="btn btn-secondary"><i class="fas fa-users"></i> Users</a>
            <a href="/reservations.html" class="btn btn-secondary"><i class="fas fa-calendar-check"></i> Reservations</a>
            <a href="/merchants.html" class="btn btn-secondary"><i class="fas fa-store"></i> Merchants</a>
            <a href="/user-reviews.html" class="btn btn-secondary"><i class="fas fa-star"></i> User Reviews</a>
        </nav>
    </header>

    <div class="main-container">
        <aside class="sidebar">
            <div class="sidebar-section">
                <h2><i class="fas fa-cogs"></i> Route Controls</h2>
                <div class="input-group">
                    <label for="route-selector">Select Bus Route</label>
                    <select id="route-selector">
                        <!-- Options will be populated by JS -->
                    </select>
                </div>
                <div class="input-group">
                    <label for="route-id-input">Route ID (Filename)</label>
                    <input type="text" id="route-id-input" placeholder="Route ID will load when you select a route" readonly style="background: rgba(255, 255, 255, 0.1);">
                    <small style="display: block; margin-top: 5px; color: rgba(255, 255, 255, 0.7); font-size: 12px;">
                        This is the route ID used in the filename. Change it to rename the route file.
                    </small>
                </div>
                <div class="input-group">
                    <label for="route-name-input">Route Name</label>
                    <input type="text" id="route-name-input" placeholder="Route name will load when you select a route">
                    <small style="display: block; margin-top: 5px; color: rgba(255, 255, 255, 0.7); font-size: 12px;">
                        Edit the route name here. It will be saved when you click "Save Current Route".
                    </small>
                </div>
                <div class="input-group">
                    <label for="route-displayed-name-input">Display Name</label>
                    <input type="text" id="route-displayed-name-input" placeholder="Custom display name shown to users">
                    <small style="display: block; margin-top: 5px; color: rgba(255, 255, 255, 0.7); font-size: 12px;">
                        Custom display name shown to users (e.g., '306 Victoria - Munxar - Xlendi - Victoria'). Leave empty to use route name.
                    </small>
                </div>
                <div class="input-group">
                    <button id="create-new-route-btn" class="btn btn-success">
                        <i class="fas fa-plus"></i> Create New Route
                    </button>
                </div>
                <div class="input-group">
                    <button id="delete-route-btn" class="btn btn-danger" disabled>
                        <i class="fas fa-trash-alt"></i> Delete Selected Route
                    </button>
                </div>
                <div class="input-group">
                    <label>Editing Mode</label>
                    <div id="mode-selector" class="filter-buttons">
                        <button id="mode-stop" class="btn active">Add Stops</button>
                        <button id="mode-shape" class="btn">Add Shape Points</button>
                    </div>
                </div>
                <!-- Route Image Upload -->
                <div class="input-group">
                    <label for="route-main-image">Route Image</label>
                    <input type="file" id="route-main-image" accept="image/*">
                    <div id="route-image-preview-container" style="display: none; margin-top: 10px;">
                        <img id="route-image-preview" style="max-width: 100%; max-height: 150px; border-radius: 8px; object-fit: cover;">
                        <button type="button" id="remove-route-image-btn" class="btn btn-secondary" style="margin-top: 8px;">
                            <i class="fas fa-times"></i> Remove Image
                        </button>
                    </div>
                    <input type="hidden" id="existing-route-image" value="">
                    <small style="display: block; margin-top: 5px; color: rgba(255, 255, 255, 0.7); font-size: 12px;">
                        This image will appear as thumbnail for all bus stops on this route
                    </small>
                </div>
                
                <div class="form-buttons">
                    <button id="save-route-btn" class="btn btn-primary">Save Current Route</button>
                    <button id="clear-route-btn" class="btn btn-secondary">Clear Map</button>
                </div>
                <p class="instructions" style="margin-top: 1rem; font-size: 0.9em;">
                    <strong>Instructions:</strong><br>
                    1. Select a route to load it.<br>
                    2. Choose "Add Stops" or "Add Shape Points" mode.<br>
                    3. Click on the map to add points. Stops require a name.<br>
                    4. Drag any point to move it.<br>
                    5. Click a point's remove button (âœ–) in the list to delete it.<br>
                    6. Click 'Save' to update the route's JSON file.
                </p>
            </div>
            <div class="sidebar-section">
                <h2><i class="fas fa-map-pin"></i> Stops</h2>
                <ul id="stops-list">
                    <!-- Stops will be listed here -->
                </ul>
            </div>
        </aside>

        <main class="content">
            <div id="map"></div>
        </main>
    </div>

    <!-- Stop Edit Modal -->
    <div id="stop-editor-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2 id="stop-form-title">Edit Bus Stop Details</h2>
            <form id="stop-form">
                <input type="hidden" id="stop-id">
                <div class="input-group">
                    <label for="stop-name">Stop Name</label>
                    <input type="text" id="stop-name" name="name" required>
                </div>
                <div class="input-group">
                    <label for="stop-description">Description</label>
                    <textarea id="stop-description" name="description"></textarea>
                </div>
                <div class="input-group">
                    <label for="stop-images">Upload Images/Schedules (PDF)</label>
                    <input type="file" id="stop-images" name="images" multiple accept="image/*,application/pdf">
                </div>
                <div id="existing-stop-images-container" class="input-group">
                    <label>Existing Files</label>
                    <div id="existing-stop-images-preview"></div>
                </div>
                <div class="form-buttons">
                    <button type="submit" class="btn btn-primary">Save Details</button>
                    <button type="button" id="cancel-stop-edit-btn" class="btn btn-secondary">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create New Route Modal -->
    <div id="create-route-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-plus-circle"></i> Create New Bus Route</h3>
                <button class="modal-close" onclick="closeCreateRouteModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form id="create-route-form">
                    <div class="form-group">
                        <label for="new-route-id"><i class="fas fa-hashtag"></i> Route ID *</label>
                        <input type="text" id="new-route-id" name="routeId" class="form-input" 
                               placeholder="e.g., 402-victoria-xlendi" required>
                        <small class="form-help">Use format: number-from-to (e.g., 401-victoria-xlendi)</small>
                    </div>
                    <div class="form-group">
                        <label for="new-route-name"><i class="fas fa-bus"></i> Route Name *</label>
                        <input type="text" id="new-route-name" name="routeName" class="form-input" 
                               placeholder="e.g., Route 401 Victoria to Xlendi" required>
                    </div>
                    <div class="form-group">
                        <label for="new-route-description"><i class="fas fa-info-circle"></i> Description</label>
                        <textarea id="new-route-description" name="description" class="form-input" 
                                  placeholder="Optional description of the route"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="new-route-image"><i class="fas fa-image"></i> Route Image</label>
                        <input type="file" id="new-route-image" name="routeImage" class="form-input" 
                               accept="image/*">
                        <small class="form-help">This image will appear as thumbnail for all bus stops on this route</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeCreateRouteModal()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button type="button" class="btn btn-primary" onclick="createNewRoute()">
                    <i class="fas fa-plus"></i> Create Route
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Route Confirmation Modal -->
    <div id="delete-route-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-triangle"></i> Delete Bus Route</h3>
                <button class="modal-close" onclick="closeDeleteRouteModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div id="delete-confirmation-step-1">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: #f59e0b; margin-bottom: 16px;"></i>
                        <h4 style="color: white; margin-bottom: 16px;">Are you sure you want to delete this route?</h4>
                        <p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 20px;">
                            Route: <strong id="delete-route-name-1"></strong>
                        </p>
                        <p style="color: rgba(255, 255, 255, 0.7); font-size: 14px;">
                            This action cannot be undone. All stops and route data will be permanently deleted.
                        </p>
                    </div>
                </div>
                
                <div id="delete-confirmation-step-2" style="display: none;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <i class="fas fa-skull-crossbones" style="font-size: 48px; color: #ef4444; margin-bottom: 16px;"></i>
                        <h4 style="color: white; margin-bottom: 16px;">Are you FOR SURE FOR SURE 100% sure?</h4>
                        <p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 20px;">
                            Route: <strong id="delete-route-name-2"></strong>
                        </p>
                        <p style="color: rgba(255, 255, 255, 0.7); font-size: 14px;">
                            This is your final warning. The route will be deleted immediately and cannot be recovered.
                        </p>
                        <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px; padding: 16px; margin-top: 20px;">
                            <p style="color: #f87171; font-size: 13px; margin: 0;">
                                <i class="fas fa-info-circle"></i> 
                                Type <strong>"DELETE"</strong> below to confirm:
                            </p>
                            <input type="text" id="delete-confirmation-input" class="form-input" 
                                   placeholder="Type DELETE to confirm" style="margin-top: 12px; text-align: center;">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeDeleteRouteModal()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button type="button" id="delete-confirm-btn" class="btn btn-danger" onclick="confirmDeleteRoute()">
                    <i class="fas fa-trash-alt"></i> Delete Route
                </button>
            </div>
        </div>
    </div>

    <!-- Theme Toggle Button -->
    <div class="theme-toggle" onclick="toggleTheme()">
        <svg id="theme-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
    </div>

    <script src="lib/leaflet.js"></script>
    <script src="image-upload-progress.js"></script>
    <script src="image-gallery-modal.js"></script>
    <script src="theme-toggle.js"></script>
    <script src="bus-editor.js"></script>
</body>
</html>
